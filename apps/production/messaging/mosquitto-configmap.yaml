apiVersion: v1
kind: ConfigMap
metadata:
  name: mosquitto-config
  namespace: messaging
data:
  mosquitto.conf: |
    # Mosquitto MQTT Broker Configuration
    # Shared instance for multiple applications

    # Persistence
    persistence true
    persistence_location /mosquitto/data/

    # Logging
    log_dest stdout
    log_type error
    log_type warning
    log_type notice
    log_type information

    # Network
    listener 1883
    protocol mqtt

    # No authentication for internal cluster use
    # Applications connect via service name
    allow_anonymous true

    # Connection limits
    max_connections -1

    # Message size limits (default 256MB, suitable for telemetry)
    # Using max_packet_size (new parameter name in Mosquitto 2.x)
    max_packet_size 268435456
