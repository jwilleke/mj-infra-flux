apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: nextcloud
  annotations:
    # --- Traefik Specific Annotations ---
    # Enable Traefik IngressRoute generation for this Ingress
    traefik.ingress.kubernetes.io/router.entrypoints: websecure # Expose on HTTPS entrypoint
    traefik.ingress.kubernetes.io/router.tls: "true" # Enable TLS for this router

    # --- Cert-Manager Specific Annotations ---
    # Instruct Cert-Manager to issue a certificate for this Ingress
    cert-manager.io/cluster-issuer: letsencrypt-prod # Or 'letsencrypt-staging', or your internal issuer
    # You might also use:
    # kubernetes.io/tls-acme: "true" # Older annotation for cert-manager, still works for some setups

    # --- Optional: Nextcloud Specific Ingress Rewrite ---
    # Some Nextcloud setups might benefit from these, but often not strictly needed
    # if Nextcloud is configured correctly to handle its base URL.
    # traefik.io/router.middlewares: default-nextcloud-redirectregex@kubernetescrd # Example for advanced rewrites
    # Example for enabling compression (Traefik v2 specific)
    # traefik.ingress.kubernetes.io/router.middlewares: traefik-compress@kubernetescrd # If you have a custom middleware for compression

  labels:
    app: nextcloud
spec:
  rules:
    - nc.nerdsbythehour.com # REPLACE WITH YOUR ACTUAL DOMAIN
  http:
    paths:
    - path: /
      pathType: Prefix
      backend:
        service:
          name: nextcloud-service # This should be the name of your ClusterIP service
          port:
            number: 80 # Or 443 if your Nextcloud pod listens on 443
  tls:
    - hosts:
        - nc.nerdsbythehour.com # REPLACE WITH YOUR ACTUAL DOMAIN
      secretName: nextcloud-tls # Cert-Manager will store the generated certificate here